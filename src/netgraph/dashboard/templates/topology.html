<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NetGraph â€” Topology</title>
    <style>
        body { margin: 0; font-family: sans-serif; background: #0f0f23; color: #e0e0e0; }
        .navbar { background: #1a1a3e; padding: 15px 30px; display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid #e94560; }
        .navbar h1 { color: #e94560; }
        .navbar nav a { color: #e0e0e0; text-decoration: none; margin-left: 20px; padding: 8px 16px; border-radius: 4px; }
        .navbar nav a:hover { background: #e94560; }
        .content { padding: 20px; max-width: 1400px; margin: 0 auto; }
        #viz { width: 100%; height: 70vh; border: 1px solid #2a2a5e; border-radius: 8px; background: #1a1a3e; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px 15px; text-align: left; border-bottom: 1px solid #2a2a5e; }
        th { background: #1a1a3e; color: #e94560; }
        .badge { padding: 3px 8px; border-radius: 4px; font-size: 12px; }
        .badge-critical { background: #e94560; }
        .badge-high { background: #ff6b35; }
        .badge-medium { background: #ffa600; color: #000; }
        .badge-low { background: #2ecc71; }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="navbar">
        <h1>NetGraph / Topology</h1>
        <nav>
            <a href="/">Dashboard</a>
            <a href="/topology">Topology</a>
            <a href="/anomaly">Anomalies</a>
            <a href="/predict">Predictions</a>
            <a href="/impact">Impact</a>
        </nav>
    </div>
    <div class="content">
        <div id="viz"></div>
        <div id="data-table"></div>
    </div>
    <script>
        fetch('/api/v1/topology')
            .then(r => r.json())
            .then(data => {
                const width = document.getElementById('viz').clientWidth;
                const height = document.getElementById('viz').clientHeight;
                const svg = d3.select('#viz').append('svg').attr('width', width).attr('height', height);
                const g = svg.append('g');
                svg.call(d3.zoom().on('zoom', e => g.attr('transform', e.transform)));
                const sim = d3.forceSimulation(data.nodes)
                    .force('link', d3.forceLink(data.links).id(d => d.index).distance(80))
                    .force('charge', d3.forceManyBody().strength(-200))
                    .force('center', d3.forceCenter(width/2, height/2));
                const link = g.selectAll('line').data(data.links).enter().append('line')
                    .attr('stroke', '#4a4a6a').attr('stroke-width', 2);
                const node = g.selectAll('circle').data(data.nodes).enter().append('circle')
                    .attr('r', 8).attr('fill', d => d.group === 'router' ? '#e94560' : '#0f3460')
                    .call(d3.drag().on('start', (e,d) => { sim.alphaTarget(0.3).restart(); d.fx=d.x; d.fy=d.y; })
                        .on('drag', (e,d) => { d.fx=e.x; d.fy=e.y; })
                        .on('end', (e,d) => { sim.alphaTarget(0); d.fx=null; d.fy=null; }));
                const text = g.selectAll('text').data(data.nodes).enter().append('text')
                    .text(d => d.id).attr('fill', '#e0e0e0').attr('font-size', '11px').attr('dx', 12).attr('dy', 4);
                sim.on('tick', () => {
                    link.attr('x1', d=>d.source.x).attr('y1', d=>d.source.y).attr('x2', d=>d.target.x).attr('y2', d=>d.target.y);
                    node.attr('cx', d=>d.x).attr('cy', d=>d.y);
                    text.attr('x', d=>d.x).attr('y', d=>d.y);
                });
            }).catch(e => { document.getElementById('viz').innerHTML = '<p style="padding:20px;">Load a topology first via the API.</p>'; });
    </script>
</body>
</html>
